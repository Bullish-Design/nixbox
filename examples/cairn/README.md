# Cairn Agent Examples

This directory contains example agent code that demonstrates how Cairn agents work.

## Overview

Agent code runs in a Monty sandbox with access to only the external functions provided. These examples show common patterns for agent tasks.

## Available External Functions

All agents have access to these functions:

- `read_file(path: str) -> str` - Read file from overlay (falls through to stable)
- `write_file(path: str, content: str) -> bool` - Write file to overlay only
- `list_dir(path: str) -> list[str]` - List directory contents
- `file_exists(path: str) -> bool` - Check if file exists
- `search_files(pattern: str) -> list[str]` - Find files matching glob pattern
- `search_content(pattern: str, path: str) -> list[dict]` - Search file contents
- `ask_llm(prompt: str, context: str) -> str` - Query LLM for assistance
- `submit_result(summary: str, changed_files: list[str]) -> bool` - Submit results
- `log(message: str) -> bool` - Log debug message

## Examples

### add_docstrings.py

Adds docstrings to Python functions that don't have them.

**Pattern**: Search → Read → Transform → Write

```python
files = search_files("*.py")
for file_path in files:
    content = read_file(file_path)
    new_content = ask_llm("Add docstrings", content)
    write_file(file_path, new_content)
```

### fix_todos.py

Implements TODO comments in code.

**Pattern**: Content Search → Group → Transform → Write

```python
results = search_content("TODO", ".")
# Group by file and process
for file_path, todos in grouped_todos.items():
    content = read_file(file_path)
    new_content = ask_llm("Implement TODOs", content)
    write_file(file_path, new_content)
```

### add_type_hints.py

Adds type hints to Python function signatures.

**Pattern**: Filter → Check → Transform → Write

```python
py_files = search_files("*.py")
for file_path in py_files:
    if needs_type_hints(file_path):
        content = read_file(file_path)
        new_content = ask_llm("Add type hints", content)
        write_file(file_path, new_content)
```

## Constraints

Agent code must follow these constraints:

1. **No imports**: Cannot use `import` statements
2. **No file I/O**: Cannot use `open()`, only external functions
3. **No network**: Cannot make network calls directly
4. **No exec/eval**: Cannot use `eval()` or `exec()`
5. **Must submit**: Must call `submit_result()` at the end

## Running Examples

These examples are meant to be executed by the Cairn orchestrator, not directly. They demonstrate the code patterns that would be generated by the LLM based on user tasks.

To test an example:

```python
from cairn.executor import AgentExecutor
from cairn.external_functions import create_external_functions

# Load example code
with open("examples/cairn/add_docstrings.py") as f:
    code = f.read()

# Setup external functions
ext_funcs = create_external_functions(agent_id, agent_fs, stable_fs, llm)

# Execute
executor = AgentExecutor()
result = await executor.execute(code, ext_funcs, agent_id)
```

## Best Practices

1. **Use log()**: Log progress for debugging
2. **Handle errors**: Use try/except for file operations
3. **Check before modifying**: Verify files need changes
4. **Track changes**: Keep list of modified files
5. **Submit clearly**: Provide clear summary in submit_result()

## See Also

- [SKILL-MONTY.md](../../.agent/skills/SKILL-MONTY.md) - Monty sandbox guide
- [SKILL-AGENTFS.md](../../.agent/skills/SKILL-AGENTFS.md) - AgentFS guide
- [SPEC.md](../../SPEC.md) - Technical specification
